<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interaktiv Fraktalgenerator</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; width: 100vw; height: 100vh; }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 8px;
      color: white;
      font-family: sans-serif;
    }
    input[type=range] {
      width: 150px;
    }
  </style>
</head>
<body>
<canvas id="glcanvas"></canvas>
<div id="controls">
  <label>Zoom: <input type="range" id="zoom" min="0.1" max="2.0" step="0.01" value="1"></label><br>
  <label>Julia Cx: <input type="range" id="cx" min="-1.5" max="1.5" step="0.01" value="0.285"></label><br>
  <label>Julia Cy: <input type="range" id="cy" min="-1.5" max="1.5" step="0.01" value="0.01"></label><br>
  <label>Fraktal: 
    <select id="fractalType">
      <option value="0">Mandelbrot</option>
      <option value="1">Julia</option>
    </select>
  </label><br>
  <button id="saveBtn">Spara bild</button>
</div>
<script>
const vertexShaderSource = `
  attribute vec2 a_position;
  void main() {
    gl_Position = vec4(a_position, 0, 1);
  }
`;

const fragmentShaderSource = `
  precision highp float;
  uniform vec2 u_resolution;
  uniform float u_time;
  uniform int u_type;
  uniform vec2 u_c;
  uniform float u_zoom;

  int mandelbrot(vec2 z) {
    vec2 c = z;
    int iter;
    for (iter = 0; iter < 256; iter++) {
      float x = (z.x * z.x - z.y * z.y) + c.x;
      float y = (2.0 * z.x * z.y) + c.y;
      if (x*x + y*y > 4.0) break;
      z = vec2(x, y);
    }
    return iter;
  }

  int julia(vec2 z, vec2 c) {
    int iter;
    for (iter = 0; iter < 256; iter++) {
      float x = (z.x * z.x - z.y * z.y) + c.x;
      float y = (2.0 * z.x * z.y) + c.y;
      if (x*x + y*y > 4.0) break;
      z = vec2(x, y);
    }
    return iter;
  }

  void main() {
    vec2 uv = (gl_FragCoord.xy - 0.5 * u_resolution.xy) / u_resolution.y;
    uv *= u_zoom;
    int n = u_type == 0 ? mandelbrot(uv) : julia(uv, u_c);
    float color = float(n) / 256.0;
    gl_FragColor = vec4(vec3(sin(color * 6.2831), cos(color * 4.0), color), 1.0);
  }
`;

function createShader(gl, type, source) {
  const shader = gl.createShader(type);
  gl.shaderSource(shader, source);
  gl.compileShader(shader);
  return shader;
}

function createProgram(gl, vShader, fShader) {
  const program = gl.createProgram();
  gl.attachShader(program, vShader);
  gl.attachShader(program, fShader);
  gl.linkProgram(program);
  return program;
}

function main() {
  const canvas = document.getElementById("glcanvas");
  const gl = canvas.getContext("webgl");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const vShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
  const fShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);
  const program = createProgram(gl, vShader, fShader);

  const positionAttribute = gl.getAttribLocation(program, "a_position");
  const buffer = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
    -1, -1, 1, -1, -1, 1,
    -1, 1, 1, -1, 1, 1
  ]), gl.STATIC_DRAW);

  gl.useProgram(program);
  gl.enableVertexAttribArray(positionAttribute);
  gl.vertexAttribPointer(positionAttribute, 2, gl.FLOAT, false, 0, 0);

  const resLoc = gl.getUniformLocation(program, "u_resolution");
  const timeLoc = gl.getUniformLocation(program, "u_time");
  const typeLoc = gl.getUniformLocation(program, "u_type");
  const cLoc = gl.getUniformLocation(program, "u_c");
  const zoomLoc = gl.getUniformLocation(program, "u_zoom");

  const zoomSlider = document.getElementById("zoom");
  const cxSlider = document.getElementById("cx");
  const cySlider = document.getElementById("cy");
  const fractalSelect = document.getElementById("fractalType");
  const saveBtn = document.getElementById("saveBtn");

  saveBtn.addEventListener("click", () => {
    const link = document.createElement('a');
    link.download = 'fractal.png';
    link.href = canvas.toDataURL();
    link.click();
  });

  function render(t) {
    gl.viewport(0, 0, canvas.width, canvas.height);
    gl.uniform2f(resLoc, canvas.width, canvas.height);
    gl.uniform1f(timeLoc, t * 0.001);
    gl.uniform1i(typeLoc, parseInt(fractalSelect.value));
    gl.uniform2f(cLoc, parseFloat(cxSlider.value), parseFloat(cySlider.value));
    gl.uniform1f(zoomLoc, parseFloat(zoomSlider.value));
    gl.drawArrays(gl.TRIANGLES, 0, 6);
    requestAnimationFrame(render);
  }
  requestAnimationFrame(render);
}

main();
</script>
</body>
</html>
